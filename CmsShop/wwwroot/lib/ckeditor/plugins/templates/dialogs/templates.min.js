CKEDITOR.dialog.add("templates",function(s){function c(a,e){var t=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),l='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';return a.image&&e&&(l+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(e+a.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>'),l+='<td style="white-space:normal;"><span class="cke_tpl_title">'+a.title+"</span><br/>",a.description&&(l+="<span>"+a.description+"</span>"),l+="</td></tr></table>",t.getFirst().setHtml(l),t.on("click",function(){var e,t;e=a.html,(t=CKEDITOR.dialog.getCurrent()).getValueOf("selectTpl","chkInsertOpt")?(s.fire("saveSnapshot"),s.setData(e,function(){t.hide();var e=s.createRange();e.moveToElementEditStart(s.editable()),e.select(),setTimeout(function(){s.fire("saveSnapshot")},0)})):(s.insertHtml(e),t.hide())}),t}function e(e){var t=e.data.getTarget(),a=d.equals(t);if(a||d.contains(t)){var l,s=e.data.getKeystroke(),i=d.getElementsByTag("a");if(i){if(a)l=i.getItem(0);else switch(s){case 40:l=t.getNext();break;case 38:l=t.getPrevious();break;case 13:case 32:t.fire("click")}l&&(l.focus(),e.data.preventDefault())}}}var t=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(t.path+"dialogs/templates.css"));var d,t="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),m=s.lang.templates,g=s.config;return{title:s.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:m.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+m.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+t+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+t+'">'+m.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:m.insertOption,default:g.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var r=this.getContentElement("selectTpl","templatesList");d=r.getElement(),CKEDITOR.loadTemplates(g.templates_files,function(){var e=(g.templates||"default").split(",");if(e.length){var t=d;t.setHtml("");for(var a=0,l=e.length;a<l;a++)for(var s=CKEDITOR.getTemplates(e[a]),i=s.imagesPath,n=(s=s.templates).length,p=0;p<n;p++){var o=c(s[p],i);o.setAttribute("aria-posinset",p+1),o.setAttribute("aria-setsize",n),t.append(o)}r.focus()}else d.setHtml('<div class="cke_tpl_empty"><span>'+m.emptyListMsg+"</span></div>")}),this._.element.on("keydown",e)},onHide:function(){this._.element.removeListener("keydown",e)}}});